language: python
dist: bionic
matrix:
  include:
  - python: '2.7'
  - python: '3.5'
  - python: '3.6'
  - python: '3.7'
  - python: 3.8-dev
  allow_failures:
  - python: 3.8-dev
before_install:
- sudo rm /etc/apt/apt.conf.d/99-travis-apt-proxy
- sudo apt-get update
- sudo apt-get install -y --no-install-recommends python-apsw
- mkdir /opt/acestream
- cd /opt/acestream
- curl -s http://acestream.org/downloads/linux/acestream_3.1.49_debian_9.9_x86_64.tar.gz
  | tar xzf -
- "./acestreamengine --client-console --log-file acestream.log 2>&1 & cd -"
- pip install --disable-pip-version-check --upgrade pip setuptools
- pip install pytest-cov pytest-flake8 codecov
install:
- pip install .
script:
- python -m pytest --cache-clear --cov=. --flake8
after_success:
- codecov
deploy:
  provider: pypi
  user: "__token__"
  password:
    secure: "n+QsY5bzvz5rd8Us06WRPK96SdZPp/fJbr3/W7mh512RFfAn3A8IO/h1gJOtscEDZq8s7LU7PZeLR5Y0TCscmUCiMldB+UgPYiglLieoXgTUebKUIm3iqlqAHAQ4VZT2no78RXgK1QZ0T+TcrsjTnX7op3KjwQL4jXYjAnECLkXh7n8sIa11Cy2wlErmKaOjn1ivAso6X2YsRqlUHHvziNE95olvmQuiwgxUCMy8ks5AITWn2+g+61A1hcQVJ4KoZAZoNNR8LgopjcETD8X7bkABejf5zIx83DAoj84HtNp9W8940wn2gnB7hwhsiygBLPeYg7Q8mzcmvziE2bT412zC/0PA7EMvzDHB6+YcmQn5qlgJzu9AkBXzuJvnAtAz3v4fk+H/nO0AFeGNKHIl1XqZWoD8urH/ks6/0FezdOxHSqDljH3YQ2V1je11hfsCqPdx1K2oH0o8S4ewgCLUXAQmORG6NGbfiib3KyQPQbncqKU5KPeTxT0hZwJ64xFJdsHZZUIWw5LM+FlXW+dzDPJBYz1cqU9R64RTo2qpwPOuErEM3Nxan01ncfuY+7zZkf/TeXTGeXK/ehF8Vxb33qAiTnHdYPcgI6jLi7sKKj2hS4ahEVquRxp0QSQqSgkMweKBlbjziDh3ztW6mqRmfDIJwJnxwoO5L8wx4c83Ezw="
  on:
    tags: true
